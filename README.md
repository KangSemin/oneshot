# 🍹oneshot🍷
칵테일 마니아층을 위한 칵테일과 재료조회 및 관련물품 판매 서비스

프로젝트 기간 : 2025-02-11 ~ 2025-03-17

# ✨주요서비스
펜트리의 저장된 기주로 칵테일 검색
인기칵테일
실시간 채팅식 문의기능
OPENRUN EVENT 

# 💡KEY SUMMARY
## KEY Summary

### 🍁 **성능 개선 : 최저가 상품 조회 성능, Redis 도입으로 3배 이상 향상**

---

1. **한 줄 요약**  
   - Redis 도입으로 기존 DB 조회보다 **348% 성능 개선**  
   - 대규모 트래픽 환경에서도 안정적인 서비스 유지  

   ![성능 개선 이미지]

2. **도입 배경**  
   - 상품의 최저가를 제공하기 위해 외부 서버에서 제공하는 타임세일 상품의 할인율과  
     상품 자체의 할인율을 비교하는 기능이 필요  

3. **기술적 선택지**  

   1. **DB 데이터 적재**  
      - 스케줄링 작업으로 짧은 시간 내 대량의 데이터를 수정하는 것은 데이터베이스에 과도한 부하 발생  
      - 상품 자체의 할인율과 타임세일 할인율을 분리하여 별도 컬럼 저장 필요  

   2. **Redis 캐싱**  
      - 실시간 최저가 할인율로 최신 정보와 가격 제공  
      - TTL 설정으로 타임세일 종료 시 자동 데이터 삭제  

   **결론:** Redis 도입을 결정하여 성능 및 효율성을 크게 개선  

---

### 🍁 **트러블 슈팅 : LazyConnectionDataSourceProxy - 불필요한 커넥션 점유 해결**

---

1. **배경**  
   - **스프링 배치 5버전 도입**  
     - 정산은 실시간이 아닌, 이용자가 적은 시간에 일괄 처리하도록 배치 선택  
     - 메인 DB와 배치 메타데이터 DB 분리 필요  
   - **배치 메타데이터 테이블 생성 필수화**  
     - 메타데이터 전용 DB를 나누는 구조로 전환  
   - **멀티 DataSource 구성**  
     - 메인 DataSource와 배치 DataSource로 데이터베이스 모듈 구분  

2. **문제**  
   - 실제 DB 요청 없이도 불필요한 커넥션 점유 발생  
     - 스프링은 트랜잭션 진입 시 커넥션 풀에서 커넥션을 점유  
     - 멀티 DataSource로 인해 두 DataSource 모두 커넥션 점유  

3. **해결 방안**  
   - **LazyConnectionDataSourceProxy 클래스 사용**  
     - 실제 DB 요청 전까지 커넥션 점유를 지연시키는 프록시 DataSource 활용  

   ![LazyConnectionDataSourceProxy 이미지]

   - 이를 통해 **실제 DB 요청 시에만 커넥션 점유**로 불필요한 리소스 낭비를 해결




 

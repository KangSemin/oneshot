<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>주소 검색</title>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const addressNameInput = document.getElementById("addressName");
            const postcodeInput = document.getElementById("postcode");
            const addressInput = document.getElementById("address");
            const detailAddressInput = document.getElementById("detailAddress");
            const extraAddressInput = document.getElementById("extraAddress");
            const searchButton = document.getElementById("searchAddressBtn");
            const submitButton = document.getElementById("submitFormBtn");

            // 주소 검색 함수
            function searchAddress() {
                new daum.Postcode({
                    oncomplete: function (data) {
                        postcodeInput.value = data.zonecode;
                        addressInput.value = data.address;
                        detailAddressInput.focus();
                    }
                }).open();
            }

            async function submitForm() {
                const requestData = {
                    addressName: addressNameInput.value.trim(),
                    postcode: postcodeInput.value.trim(),
                    postAddress: addressInput.value.trim(),
                    detailAddress: detailAddressInput.value.trim(),
                    extraAddress: extraAddressInput.value.trim()
                };

                try {
                    const response = await fetch("/api/addresses", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${localStorage.getItem('token')}`
                        },
                        body: JSON.stringify(requestData)
                    });

                    const responseText = await response.text();

                    if (!response.ok) {
                        throw new Error(`서버 응답 실패: ${response.status}, 내용: ${responseText}`);
                    }

                    const data = JSON.parse(responseText);
                    alert("주소가 저장되었습니다. (ID: " + data.id + ")");
                } catch (error) {
                    console.error("주소 저장 실패 상세 정보:", error);
                    alert("주소 저장에 실패했습니다.");
                }
            }

            // 이벤트 리스너 등록
            searchButton.addEventListener("click", searchAddress);
            submitButton.addEventListener("click", submitForm);
        });
    </script>
    <style>
        .address-container {
            max-width: 500px;  /* 컨테이너 최대 너비 */
            margin: 0 auto;    /* 중앙 정렬 */
            padding: 20px;     /* 여백 */
        }

        .form-group {
            margin-bottom: 15px;  /* 각 입력 그룹 사이 간격 */
        }

        input[type="text"] {
            width: 100%;          /* 입력창 너비 */
            padding: 8px;         /* 내부 여백 */
            margin: 5px 0;        /* 위아래 여백 */
            box-sizing: border-box;  /* padding이 너비에 포함되도록 */
        }

        /* 우편번호 입력창과 검색 버튼을 한 줄에 */
        .postcode-group {
            display: flex;
            gap: 10px;  /* 우편번호와 버튼 사이 간격 */
        }

        .postcode-group input {
            width: 150px;  /* 우편번호 입력창 너비 */
        }

        button {
            padding: 8px 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="address-container">
    <h1>주소 검색</h1>

    <div class="form-group">
        <label for="addressName">주소지 이름</label>
        <input type="text" id="addressName" placeholder="예: 집, 회사">
    </div>

    <div class="form-group postcode-group">
        <div>
            <label for="postcode">우편번호</label>
            <input type="text" id="postcode" placeholder="우편번호" readonly>
        </div>
        <button type="button" id="searchAddressBtn">주소 검색</button>
    </div>

    <div class="form-group">
        <label for="address">주소</label>
        <input type="text" id="address" placeholder="주소" readonly>
    </div>

    <div class="form-group">
        <label for="detailAddress">상세주소</label>
        <input type="text" id="detailAddress" placeholder="상세주소">
    </div>

    <div class="form-group">
        <label for="extraAddress">참고항목</label>
        <input type="text" id="extraAddress" placeholder="참고항목">
    </div>

    <button type="button" id="submitFormBtn">저장</button>
</div>
</body>
</html>

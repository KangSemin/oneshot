<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <title>Ingredient Upload</title>
</head>
<body>
<h1>Upload Ingredient</h1>
<form id="ingredientForm">
    <!-- 텍스트 입력 필드 -->
    <div>
        <label for="name">Name</label>
        <input id="name" name="name" type="text" required />
    </div>

    <div>
        <label for="description">Description</label>
        <input id="description" name="description" type="text" required />
    </div>

    <div>
        <label for="avb">avb</label>
        <input id="avb" name="avb" type="number" required />
    </div>

    <div>
        <label for="category">Category</label>
        <input id="category" name="category" type="text" required />
    </div>

    <!-- 이미지 파일 (MultipartFile) -->
    <div>
        <label for="imageFile">Ingredient Image</label>
        <input id="imageFile" name="imageFile" type="file" accept="image/*" />
    </div>

    <!-- Submit 버튼 -->
    <button id="submitFormBtn" type="submit">Create</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        async function submitForm(event) {
            event.preventDefault();  // 🔹 form 기본 제출 방지

            const form = document.getElementById('ingredientForm');
            const formData = new FormData(form);

            // 🔹 이미지 파일 선택 안 했을 경우, formData에서 제거
            if (!formData.get("imageFile").name) {
                formData.delete("imageFile");
            }

            try {
                const response = await fetch('/api/ingredients', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.text();
                    alert('Ingredient created successfully!\n\nServer response:\n' + result);
                } else {
                    throw new Error('Server Error: ' + response.status);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        const submitButton = document.getElementById("submitFormBtn");
        submitButton.addEventListener("click", submitForm);
    });
</script>
</body>
</html>

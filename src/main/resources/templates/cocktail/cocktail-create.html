<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <title>Recipe Upload</title>
</head>
<body>
<h1>Upload your recipe</h1>
<form id="cocktailForm">
    <!-- 1) 기본 텍스트 필드들 -->
    <div>
        <label for="name">Name</label>
        <input id="name" name="name" type="text" required />
    </div>

    <div>
        <label for="description">Description</label>
        <input id="description" name="description" type="text" required />
    </div>

    <div>
        <label for="recipe">Recipe</label>
        <textarea id="recipe" name="recipe" rows="3" cols="50" required></textarea>
    </div>

    <!-- 2) 재료 리스트 (IngredientRequestDto) -->
    <!-- 인덱스[0], [1]... 식으로 여러 재료를 보내려면, 아래처럼 반복 -->
    <div>
        <label>Ingredient #1:</label>
        <input type="number" name="ingredientList[0].ingredientId" placeholder="Ingredient ID" />
        <input type="text"   name="ingredientList[0].volume"       placeholder="Volume" />
    </div>

    <div>
        <label>Ingredient #2:</label>
        <input type="number" name="ingredientList[1].ingredientId" placeholder="Ingredient ID" />
        <input type="text"   name="ingredientList[1].volume"       placeholder="Volume" />
    </div>

    <!--
      필요하다면 자바스크립트를 통해 동적으로
      ingredientList[n].ingredientId / volume를 추가하는 로직을 구현할 수도 있습니다.
    -->

    <!-- 3) 이미지 파일 (MultipartFile) -->
    <div>
        <label for="imageFile">Cocktail Image</label>
        <input id="imageFile" name="imageFile" type="file" accept="image/*" />
    </div>

    <!-- 4) Submit 버튼 -->
    <button id="submitFormBtn" type="submit">Create</button>
</form>

<script th:nonce="${scriptNonce}">
    document.addEventListener('DOMContentLoaded', function () {
        async function submitForm() {
            // form 태그 자체를 가져옴
            const form = document.getElementById('cocktailForm');
            // FormData 객체에 form 태그의 모든 요소를 담음
            const formData = new FormData(form);

            try {
                // Spring Boot 서버 주소 (예: 로컬호스트)
                const response = await fetch('http://localhost:8080/api/cocktails', {
                    method: 'POST',
                    body: formData,
                    // credentials: "include" // 쿠키가 포함되도록 설정
                });

                if (response.ok) {
                    const result = await response.text();
                    alert('Cocktail created successfully!\n\nServer response:\n' + result);
                } else {
                    throw new Error('Server Error: ' + response.status);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        const submitButton = document.getElementById("submitFormBtn");
        submitButton.addEventListener("click", submitForm);
    });
</script>
</body>
</html>
